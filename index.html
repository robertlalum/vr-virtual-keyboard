
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>VR Keyboard + Aligned Text & Cursor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>
<body>
<a-scene background="color: #111" vr-mode-ui="enterVRButton: true">
  
  <!-- Camera + Controllers -->
  <a-entity id="cameraRig">
    <a-entity id="camera" camera look-controls position="0 1.6 0"></a-entity>
    <a-entity id="rightHand" laser-controls="hand: right" raycaster="objects: .key; showLine:true"></a-entity>
  </a-entity>

  <!-- Text Panel -->
  <a-entity id="screen" position="0 1.6 -1.2">
    <a-plane width="1.6" height="0.6" color="#222"></a-plane>

    <!-- Group for both text and cursor -->
    <a-entity id="textGroup" position="-0.75 0.25 0.01">
      <a-entity id="typedText"
        text="value: ; color:#fff; width:1.5; align:left; wrapCount:30; baseline:top">
      </a-entity>
      <a-plane id="cursor" color="#fff" width="0.01" height="0.05" position="0 0 0.02"></a-plane>
    </a-entity>
  </a-entity>

  <!-- Keyboard -->
  <a-entity id="keyboard" position="0 1.1 -1.2"></a-entity>
</a-scene>

<script>
const layout = [
  ['1','2','3','4','5','6','7','8','9','0'],
  ['Q','W','E','R','T','Y','U','I','O','P'],
  ['A','S','D','F','G','H','J','K','L'],
  ['Z','X','C','V','B','N','M','Back'],
  ['Space','Enter','!','@','#','$']
];

let buffer = '';
const typedText = document.getElementById('typedText');
const cursor = document.getElementById('cursor');
const charsPerLine = 30;
const charWidth = 0.045;
const lineHeight = 0.055;

function updateScreen() {
  typedText.setAttribute('text', `value: ${buffer}; color:#fff; width:1.5; align:left; wrapCount:${charsPerLine}; baseline:top`);

  // Manual cursor placement based on same coordinate origin
  const lines = buffer.split('\n').flatMap(line => {
    if (line.length <= charsPerLine) return [line];
    const wrapped = [];
    for (let i = 0; i < line.length; i += charsPerLine)
      wrapped.push(line.slice(i, i + charsPerLine));
    return wrapped;
  });

  const lastLine = lines[lines.length - 1] || '';
  const x = charWidth * lastLine.length;
  const y = -lineHeight * (lines.length - 1);
  cursor.setAttribute('position', `${x} ${y} 0.02`);
}

function handleKey(k) {
  if (k === 'Back') buffer = buffer.slice(0, -1);
  else if (k === 'Space') buffer += ' ';
  else if (k === 'Enter') buffer += '\n';
  else buffer += k;
  updateScreen();
}

function createKeyboard() {
  const parent = document.getElementById('keyboard');
  const keyW = 0.14, keyH = 0.12, gap = 0.01;
  layout.forEach((row, r) => {
    let rowWidth = row.length * (keyW + gap);
    let startX = -0.7 + (1.0 - rowWidth) / 2 + r * 0.02;
    row.forEach(k => {
      let w = (k === 'Space') ? (keyW * 5 + gap * 4) : (k === 'Enter' ? keyW * 1.7 : keyW);
      const el = document.createElement('a-entity');
      el.setAttribute('geometry', `primitive: plane; width:${w}; height:${keyH}`);
      el.setAttribute('material', 'color:#333; shader:flat');
      el.setAttribute('position', `${startX + w / 2} ${-r * (keyH + gap)} 0`);
      el.setAttribute('class', 'key');
      const label = document.createElement('a-entity');
      label.setAttribute('text', `value:${k}; align:center; width:2; color:#fff`);
      label.setAttribute('position', '0 0 0.01');
      el.appendChild(label);
      el.addEventListener('click', () => handleKey(k));
      parent.appendChild(el);
      startX += w + gap;
    });
  });
}

setTimeout(() => { createKeyboard(); updateScreen(); }, 500);
setInterval(() => { cursor.setAttribute('visible', !cursor.getAttribute('visible')); }, 500);
</script>
</body>
</html>

    
